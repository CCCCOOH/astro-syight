---
import { getCollection } from "astro:content";
import { article, site } from "../../config/site";
import { sticky_sort, posts_filter } from "../../scripts/utils";

export async function getStaticPaths() {
  const allPosts = posts_filter(sticky_sort(await getCollection('blog')));
  const size = article.page_size;
  const maxSize = Math.ceil(allPosts.length / size);
  
  let res: array = [];
  let page_num = Math.ceil(allPosts.length / size);
  for (let page = 1; page <= page_num; page ++) {
    const curSlice = (page - 1) * size;
    res.push({
      params: { page },
      props: { 
        allPosts: allPosts.slice(curSlice, size * page), 
        page, 
        maxSize 
      }
    });
  }
  // 9
  //       1         2        3
  // 0 1 2(3)/ 3 4 5(6)/ 6 7 8(9)
  return res;
}

// 每页中获取到的数据

const { allPosts, page, maxSize } = Astro.props;
import HomeLayout from "../../layouts/HomeLayout.astro";

---

<HomeLayout pageTitle={`${site.title}｜第${page}页`} allPosts={allPosts} maxSize={maxSize} page={page} />